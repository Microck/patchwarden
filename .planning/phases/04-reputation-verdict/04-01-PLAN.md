---
phase: 04-reputation-verdict
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/mod_sentinel/models/reputation.py
  - src/mod_sentinel/agents/reputation_agent.py
  - src/mod_sentinel/store/reputation_fixtures.py
  - src/mod_sentinel/fixtures/reputation/author_history.json
  - src/mod_sentinel/fixtures/reputation/community_reports.json
  - src/mod_sentinel/models/scan.py
  - src/mod_sentinel/api/routes/scan.py
  - tests/test_reputation.py
autonomous: true

must_haves:
  truths:
    - "Reputation Agent looks up author history from a local fixture store (REP-01)"
    - "Reputation Agent checks community reports from a local fixture store (REP-02)"
    - "Scan request can include an author identifier for reputation scoring"
    - "Reputation Agent produces a normalized author score with rationale"
  artifacts:
    - path: "src/mod_sentinel/agents/reputation_agent.py"
      provides: "Reputation Agent"
    - path: "src/mod_sentinel/store/reputation_fixtures.py"
      provides: "File-backed author history + community report fixtures"
  key_links:
    - from: "src/mod_sentinel/api/routes/scan.py"
      to: "src/mod_sentinel/agents/reputation_agent.py"
      via: "reputation invocation"
      pattern: "ReputationAgent"
---

<objective>
Add a Reputation Agent that scores author reputation using local file-based fixture lookups (no scraping required for MVP).

Purpose: Support the demo narrative (new author + reports = higher risk) without depending on external APIs.
Output: Reputation models + agent + scan request/response updates + tests.
</objective>

<execution_context>
@/home/ubuntu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/ubuntu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/03-behavior-analysis/03-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reputation models + local fixture lookups + scoring heuristics</name>
  <files>
 src/mod_sentinel/models/reputation.py
 src/mod_sentinel/agents/reputation_agent.py
 src/mod_sentinel/store/reputation_fixtures.py
 src/mod_sentinel/fixtures/reputation/author_history.json
 src/mod_sentinel/fixtures/reputation/community_reports.json
 tests/test_reputation.py
  </files>
  <action>
Define `AuthorMetadata` and `ReputationResult` models.

Implement file-backed fixture lookups to satisfy MVP requirements without scraping:
- `REP-01` author history: lookup by `author_id` (or stable key) to retrieve prior mod count and account age signals.
- `REP-02` community reports: lookup by `author_id` and/or `mod_id` to retrieve report counts / report reasons.

Store fixtures as JSON files under `src/mod_sentinel/fixtures/reputation/` and load them via a small helper (`store/reputation_fixtures.py`). Keep it deterministic and local-only.

For MVP, compute a normalized `author_score` (0-1 where higher is more trustworthy) using only provided inputs:
- account age (days)
- prior mod count
- report count

Implement conservative heuristics and include rationale strings explaining the score.

If fixture data exists for the author/mod, prefer it over user-provided values; otherwise fall back to the provided metadata.
  </action>
  <verify>python3 -m pytest -q -k reputation --maxfail=1</verify>
  <done>ReputationAgent returns deterministic score + rationale using local fixture lookups for REP-01/REP-02.</done>
</task>

<task type="auto">
  <name>Task 2: Extend scan request schema to accept author identifier + optional provided metadata</name>
  <files>
 src/mod_sentinel/models/scan.py
 src/mod_sentinel/api/routes/scan.py
  </files>
  <action>
Update scan request payload to optionally include an `author` object with:
- a stable `author_id` (required for fixture lookups)
- optional additional metadata overrides for demo flexibility

Backward compatibility:
- Existing `{upload_id}` requests must still work.

Update `/scan` to compute and include `reputation` results whenever `author` is provided.
  </action>
  <verify>python3 -m pytest -q</verify>
  <done>`/scan` accepts optional author metadata and includes reputation results without breaking existing callers.</done>
</task>

</tasks>

<verification>
- Upload -> scan works with and without author metadata
- Reputation score appears when author metadata is supplied
</verification>

<success_criteria>
- Reputation results are available as an input to verdict synthesis
</success_criteria>

<output>
After completion, create `.planning/phases/04-reputation-verdict/04-01-SUMMARY.md`
</output>
